<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/2.3.0/uicons-solid-rounded/css/uicons-solid-rounded.css">
    <link rel="icon" href="./images/">
    <title>Guess Num Game</title>

    <style>
        :root { --main-color: ; --secondary-color: ; --section-padding: ; --section-background: ; --main-duration: ; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; height: 100%; }
        body { font-family: "Work Sans", sans-serif; height: 100%; background-color: #d5d5d5d5; }
        .container { height: 100%; padding-left: 10px; padding-right: 10px; margin-left: auto; margin-right: auto; display: flex; align-items: flex-start; justify-content: center; margin-top: 250px; }
        @media (min-width: 768px) {.container {width: 750px;}}
        @media (min-width: 992px) {.container {width: 970px;}}
        @media (min-width: 1200px) {.container {width: 1170px;}}
        ul {list-style: none; margin: 0; padding: 0;}
        header {padding: 20px;}
        .grid {display: grid; grid-template-columns: 60% 13.3% 13.3% 13.3%; grid-template-rows: auto; width: 100%; height: 100%;}
        .maindiv {padding: 15px; background: rgb(255, 255, 255); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); backdrop-filter: blur(8.4px); -webkit-backdrop-filter: blur(8.4px); border-radius: 10px; height: fit-content; gap: 5vh; width: 350px;}
        .text {text-align: center;}
        .text * {padding-top: 10px;}
        .input-for-secrt-num, .input-for-guess-num {width: 100%; height: 100%;}
        .maindiv .input {display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 15px; padding: 15px;}
        .maindiv .input div {display: flex; align-items: center; justify-content: center; gap: 10px;}
        input {border-radius: 25px; padding: 15px; width: 230px; height: 55px; cursor: pointer;}
        .btn {width: fit-content; height: 50px; padding: 0.45rem; border-radius: 15px; background-color: rgb(0, 166, 255); text-align: center; font-size: 19px; color: ghostwhite; font-weight: 400; border: 0; cursor: pointer;}
        th, td {border-bottom: 1px solid #eee; padding: 8px; text-align: center; font-size: 15px; font-weight: 400;}
        table {width: 100%; margin-top: 15px; border-collapse: collapse;}
    </style>
</head>
<body onload="probilitiesFunc();">
    <div class="container">
        <div class="maindiv">
            <div class="text">
                <h2>Guess The Number</h2>
                <p>Guess the 3-digit number. You'll get feedback on each attempt.</p>
            </div>

            <div class="input-for-secrt-num input">
                <div>
                    <input class="input-for-secret" type="number" placeholder="Enter your secret number" min="100" max="999" name="inp" oninput="this.value=this.value.slice(0,3)" onkeydown="if (event.key === 'Enter') {
                        outingSecrtNum(); 
                        randomNum();
                        assignPlayerSecrt();
                    }">
                    <input type="submit" class="btn btn-for-secret" style="width:90px;" onclick="outingSecrtNum();randomNum();assignPlayerSecrt();" value="Set Secrt">
                </div>
                <p class="secrt-num-out"></p>
            </div>

            <div class="input-for-guess-num input">
                <div>
                    <input type="number" class="input-for-guess" placeholder="Enter your guess" min="100" max="999" maxlength="3" oninput="this.value=this.value.slice(0,3)" onkeydown="
                        if (event.key === 'Enter') {assignPlayerGuess();countMatchingDigits(); }">
                    <input type="submit" class="btn" onclick="assignPlayerGuess();countMatchingDigits();" value="submit">
                </div>
            </div>

            <div id='attemptsContainer'>
                <table>
                    <thead>
                        <tr>
                            <th>Attempt</th>
                            <th>Player Guess</th>
                            <th>Computer Guess</th>
                        </tr>
                    </thead>
                    <tbody id="resultsLog"></tbody>
                </table>
            </div>
            <div id="gameMessage" style="font-weight: bold; margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        let playerSecretNum = 0;
        let computerSecretNum = 0;
        let playerGuessNum = 0;
        let computerGuessNum = 0;
        let probilities = [];
        let attempt = 0;
        let lastComputerGuess = null;
        let lastComputerFeedback = null;
        
        // Ù…ØªØºÙŠØ± Ø¬Ø¯ÙŠØ¯ Ù„ØªØªØ¨Ø¹ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù‚Ø¯ ØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡
        let isSecretSet = false;

        // smart function ðŸ‘‡
        function smartComputerGuess(previousGuess, previousFeedback, candidates) {
          if (!previousGuess) {
            const index = Math.floor(Math.random() * candidates.length);
            return candidates[index];
          }
          const filtered = candidates.filter(num => getFeedback(previousGuess, num) === previousFeedback);
          if (filtered.length === 0) {
            return candidates[Math.floor(Math.random() * candidates.length)];
          }
          const nextGuess = filtered[Math.floor(Math.random() * filtered.length)];
          probilities = filtered; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª
          return nextGuess;
        }

        function getFeedback(guess, secret) {
          let count = 0;
          let secretArr = secret.toString().split('');
          for (let digit of guess.toString()) {
            let index = secretArr.indexOf(digit);
            if (index !== -1) {
              count++;
              secretArr.splice(index, 1);
            }
          }
          return count;
        }

        function probilitiesFunc() {
          for (let i = 100; i < 1000; i++) {
            if (new Set(i.toString()).size === 3) probilities.push(i);
          }
        }

        function randomNum() {
          computerSecretNum = Math.floor(Math.random() * 900) + 100;
          console.log("Computer Secret:", computerSecretNum);
          return computerSecretNum;
        }

        function outingSecrtNum() {
          const inputValue = document.querySelector(".input-for-secret").value;
          if (!/^\d{3}$/.test(inputValue)) {
            alert("Write a number of 3 digits correctly!");
            return false;
          }
          document.querySelector(".secrt-num-out").innerHTML =
            "Your secret number is: " + inputValue;
            return true;
        }

        playerSecretNum = "";
        let confirmedSecret = "";
        playerGuessNum = "";

        function assignPlayerSecrt() {
          const input = document.querySelector(".input-for-secret");
          const button = document.querySelector(".btn-for-secret");
          
          if (!outingSecrtNum()) { // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹ÙŠÙŠÙ†
            return;
          }

          button.disabled = true;
          playerSecretNum = input.value;
          confirmedSecret = playerSecretNum;
          isSecretSet = true; // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØªÙ…
          console.log("Player secret assigned:", confirmedSecret);
        }

        function assignPlayerGuess() {
          const guessInput = document.querySelector(".input-for-guess");
          playerGuessNum = guessInput.value;
          
          // **Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ Ø£Ù‚Ù„ Ù…Ù† 3 Ø£Ø±Ù‚Ø§Ù…**
          if (playerGuessNum.length < 3 || !/^\d{3}$/.test(playerGuessNum)) {
            alert("Your guess must be a 3-digit number!");
            playerGuessNum = ""; // Ù…Ø³Ø­ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§
            return false;
          }
          return true;
        }

        function countMatchingDigits() {
          
          // **Ø§Ù„Ø´Ø±Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØ¨Ø¯Ø£ ÙÙŠ Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø¨Ø¯ÙˆÙ† ØªØ¹ÙŠÙŠÙ† Ø±Ù‚Ù… Ø³Ø±ÙŠ**
          if (!isSecretSet) {
            alert("Please set your secret number first!");
            return; 
          }

          if (!assignPlayerGuess()) { // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØªØ®Ù…ÙŠÙ† ØµØ§Ù„Ø­ (3 Ø£Ø±Ù‚Ø§Ù…)
              return;
          }

          attempt++;
          let playerFeedback = getFeedback(playerGuessNum, computerSecretNum);

          // ØªØ®Ù…ÙŠÙ† Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø§Ù„Ø°ÙƒÙŠ
          computerGuessNum = smartComputerGuess(lastComputerGuess, lastComputerFeedback, probilities);
          let computerFeedback = getFeedback(computerGuessNum, confirmedSecret);

          // Ø­ÙØ¸ Ø¢Ø®Ø± Ù…Ø­Ø§ÙˆÙ„Ø©
          lastComputerGuess = computerGuessNum;
          lastComputerFeedback = computerFeedback;

          const table = document.getElementById("resultsLog");
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${attempt}</td>
            <td>${playerGuessNum} (${playerFeedback} correct num)</td>
            <td>${computerGuessNum} (${computerFeedback} correct num)</td>
          `;
          table.appendChild(row);

          // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ø°Ø§ Ø­Ø¯ ÙƒØ³Ø¨
          const msg = document.getElementById("gameMessage");
          msg.style.padding = "5px";
          if (playerGuessNum == computerSecretNum) {
            msg.innerHTML = "ðŸŽ‰ You win! Computer's number was: " + computerSecretNum;
            msg.style.color = "green";
          } else if (computerGuessNum == confirmedSecret) {
            msg.innerHTML = "ðŸ’» Computer wins! It guessed your number and computer secret was: " + computerSecretNum + ".";
            msg.style.color = "red";
          } else {
            msg.innerHTML = "";
          }
          
          // Ù…Ø³Ø­ Ø®Ø§Ù†Ø© Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
          document.querySelector(".input-for-guess").value = "";
        }
    </script>
</body>
</html>
